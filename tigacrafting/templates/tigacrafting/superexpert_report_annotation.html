{% extends "tigacrafting/expert_report_annotation.html" %}
{% load staticfiles %}
{% load i18n %}

{% block title %}
    Tigatrapp Superexpert Validation
{% endblock %}

{% block navbar_left_items %}
    <li>
        <div class="btn-group" id="type_grp" data-toggle="buttons" style="margin-right:5px;">
            <label class="btn btn-info btn-sm navbar-btn" data-toggle="tooltip" data-placement="bottom" title="Public" id="public_btn">
                <input type="radio" name="options" autocomplete="off"><span class="glyphicon glyphicon-globe"></span> <span
                    class="badge">{{ n_public }}</span></label>
            <label class="btn btn-info btn-sm navbar-btn" data-toggle="tooltip" data-placement="bottom" title="Flagged" id="flagged_btn">
                <input type="radio" name="options" autocomplete="off"><span class="glyphicon glyphicon-flag"></span> <span
                    class="badge">{{ n_flagged }}</span>
            </label>
            <label class="btn btn-info btn-sm navbar-btn" data-toggle="tooltip" data-placement="bottom" title="Hidden" id="hidden_btn">
                <input type="radio" name="options" autocomplete="off"><span class="glyphicon glyphicon-remove-circle"></span> <span
                    class="badge">{{ n_hidden }}</span>
            </label>
        </div>
    </li>

                            <li>

                                <div class="btn-group" id="status_grp" data-toggle="buttons">
                                    <label class="btn btn-primary btn-sm navbar-btn" data-toggle="tooltip" data-placement="bottom" title="Unchecked" id="unchecked_btn">
                                        <input type="radio" name="pending" autocomplete="off"><span class="glyphicon glyphicon-time"></span> <span class="badge">{{ n_pending }}</span></label>
                                    <label class="btn btn-primary btn-sm navbar-btn" data-toggle="tooltip" data-placement="bottom" title="Checked and confirmed" id="confirmed_btn">
                                        <input type="radio" name="pending" autocomplete="off"><span class="glyphicon glyphicon-thumbs-up"></span> <span
                                            class="badge">{{ n_confirmed }}</span>
                                    </label>
                                    <label class="btn btn-primary btn-sm navbar-btn" data-toggle="tooltip" data-placement="bottom" title="Checked and revised" id="revised_btn">
                                        <input type="radio" name="pending" autocomplete="off"><span class="glyphicon glyphicon-thumbs-down"></span> <span
                                            class="badge">{{ n_revised }}</span>
                                    </label>
                                </div>
                            </li>

{% endblock %}

{% block grab_reports_button %}
{% endblock %}

{% block view_others_annotations %}
        <div style="overflow: auto; height: 900px;" id='other_annotations_alert{{ form.instance.id }}'
             class='alert alert-info' role='alert'>
            {{ form.instance.get_others_annotation_html | safe }}
        </div>

        <button type="button"
                onclick="$('#other_annotations_alert{{ form.instance.id }}').show();"
                class="btn btn-default btn-sm">Show Others' Annotations
        </button>
{% endblock %}


{% block filter_modal %}
    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Filters</h4>
                </div>
                <div class="modal-body">
                    <form role="form" class="form-horizontal">

                        <div class="form-group">
                            <label for="orderby_select" class="col-sm-4 control-label">Order By:</label>

                            <div class="col-sm-8">
                                <select id="orderby_select" class="selectpicker show-tick form-control">
                                    <option value="date">Report Date</option>
                                    <option value="tiger_score">Tiger Certainty Score</option>
                                    <option value="site_score">Site Certainty Score</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="tiger_certainty_select" class="col-sm-4 control-label">Tiger Certainty
                                Category:</label>

                            <div class="col-sm-8">
                                <select id="tiger_certainty_select" class="selectpicker show-tick form-control">
                                    <option value="all">{% trans 'All' %}</option>
                                    <option value="-2">Definitely not a tiger mosquito</option>
                                    <option value="-1">Probably not a tiger mosquito</option>
                                    <option value="0">Not sure</option>
                                    <option value="1">Probably a tiger mosquito</option>
                                    <option value="2">Definitely a tiger mosquito</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="site_certainty_select" class="col-sm-4 control-label">Site Certainty
                                Category:</label>

                            <div class="col-sm-8">
                                <select id="site_certainty_select" class="selectpicker show-tick form-control">
                                    <option value="all">{% trans 'All' %}</option>
                                    <option value="-2">Definitely not a breeding site</option>
                                    <option value="-1">Probably not a breeding site</option>
                                    <option value="0">Not sure</option>
                                    <option value="1">Probably a breeding site</option>
                                    <option value="2">Definitely a breeding site</option>
                                </select>
                            </div>
                        </div>
                            <div class="form-group">
                                <label for="status_select" class="col-sm-4 control-label">Status:</label>

                                <div class="col-sm-8">
                                    <select id="status_select" class="selectpicker show-tick form-control">
                                        <option value="all">All</option>
                                        <option value="public">Public</option>
                                        <option value="flagged">Flagged</option>
                                        <option value="hidden">Hidden</option>
                                    </select>
                                </div>
                            </div>

                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="button" id="filters_submit_button" class="btn btn-warning">Apply</button>
                </div>
            </div>
        </div>
    </div>


{% endblock %}



{% block filterjs %}
    <script>

        var public_btn = $("#public_btn"), flagged_btn = $("#flagged_btn"), hidden_btn = $("#hidden_btn");


        function query_selectors() {
            var qp = "?orderby=" + $("#orderby_select").val();
            qp += "&tiger_certainty=" + $("#tiger_certainty_select").val();
            qp += "&site_certainty=" + $("#site_certainty_select").val();
            qp += "&status=" + $("#status_select").val();
            return(qp);
        }


        $("#orderby_select").val("{{ orderby }}");
        $("#tiger_certainty_select").val("{{ tiger_certainty }}");
        $("#site_certainty_select").val("{{ site_certainty }}");
        $("#status_select").val("{{ status }}");

        if ("{{ final_status }}" == "public") {
            public_btn.addClass("active");
        }
        else if ("{{ final_status }}" == "flagged") {
            flagged_btn.addClass("active");
        }
        else if ("{{ final_status }}" == "hidden") {
            hidden_btn.addClass("active");
        }


        function submit_queries() {
            gear.show();
            var qp = query_selectors();
            $('#myModal').modal('hide');
            window.location.href = qp;
        }

        function submit_queries_plus(event) {
            gear.show();
            var qp = query_selectors();
            qp += event.data.extr;
            window.location.href = qp;
        }

        public_btn.on('click', {extr: '&final_status=public'}, submit_queries_plus);
        flagged_btn.on('click', { extr: '&final_status=flagged'}, submit_queries_plus);
        hidden_btn.on('click', {extr: '&final_status=hidden'}, submit_queries_plus);


        var unchecked_btn = $("#unchecked_btn"), confirmed_btn = $("#confirmed_btn"), revised_btn = $("#revised_btn");

        var pending = "{{ pending }}";
        pending == "revised" ? revised_btn.addClass("active") : (pending == "confirmed"? confirmed_btn.addClass("active") : unchecked_btn.addClass("active"));
        unchecked_btn.on('click', {extr: '&pending=unchecked'}, submit_queries_plus);
        confirmed_btn.on('click', { extr: '&pending=confirmed'}, submit_queries_plus);
        revised_btn.on('click', { extr: '&pending=revised'}, submit_queries_plus);



    </script>

{% endblock %}
