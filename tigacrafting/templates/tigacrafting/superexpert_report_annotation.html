{% extends "tigacrafting/expert_report_annotation.html" %}
{% load staticfiles %}
{% load i18n %}

{% block title %}
    <h1>Superexpert Validation</h1>
    <h2>{% if checked == 'unchecked' %}Unchecked Reports{% elif checked == 'confirmed' %}Confirmed  Reports{% elif checked == 'revised' %}Revised Reports{% endif %}</h2>
{% endblock %}

{% block instructions %}
    <p>Each of the reports displayed here has been validated by 3 experts. You may now review these reports and confirm them as is or mark them for revision and make changes using the same form that the experts used</p>
{% endblock %}

  {% block no_records_message %}
      {% if n_unchecked == 0 %}
      There are not yet any reports that have been validated by 3 experts. Please refresh this page later, once more expert validations have been completed.
      {% else %}
      There are no reports that match your search criteria.
      {% endif %}
{% endblock %}

{% block navbar_left_items %}
    <li>
        <div class="btn-group" id="type_grp" data-toggle="buttons" style="margin-right:5px;">
            <label class="btn btn-info btn-sm navbar-btn" data-toggle="tooltip" data-placement="bottom" title="Public" id="public_btn">
                <input type="radio" name="options" autocomplete="off"><span class="glyphicon glyphicon-eye-open"></span> <span
                    class="badge">{{ n_public }}</span></label>
            <label class="btn btn-info btn-sm navbar-btn" data-toggle="tooltip" data-placement="bottom" title="Flagged" id="flagged_btn">
                <input type="radio" name="options" autocomplete="off"><span class="glyphicon glyphicon-flag"></span> <span
                    class="badge">{{ n_flagged }}</span>
            </label>
            <label class="btn btn-info btn-sm navbar-btn" data-toggle="tooltip" data-placement="bottom" title="Hidden" id="hidden_btn">
                <input type="radio" name="options" autocomplete="off"><span class="glyphicon glyphicon-eye-close"></span> <span
                    class="badge">{{ n_hidden }}</span>
            </label>
        </div>
    </li>

                            <li>

                                <div class="btn-group" id="status_grp" data-toggle="buttons">
                                    <label class="btn btn-primary btn-sm navbar-btn" data-toggle="tooltip" data-placement="bottom" title="Unchecked" id="unchecked_btn">
                                        <input type="radio" name="pending" autocomplete="off"><span class="glyphicon glyphicon-time" {% if n_unchecked > 0 %}style="color:#FF8576"{% endif %}></span> <span class="badge">{{ n_unchecked }}</span></label>
                                    <label class="btn btn-primary btn-sm navbar-btn" data-toggle="tooltip" data-placement="bottom" title="Checked and confirmed" id="confirmed_btn">
                                        <input type="radio" name="pending" autocomplete="off"><span class="glyphicon glyphicon-thumbs-up"></span> <span
                                            class="badge">{{ n_confirmed }}</span>
                                    </label>
                                    <label class="btn btn-primary btn-sm navbar-btn" data-toggle="tooltip" data-placement="bottom" title="Checked and revised" id="revised_btn">
                                        <input type="radio" name="pending" autocomplete="off"><span class="glyphicon glyphicon-thumbs-down"></span> <span
                                            class="badge">{{ n_revised }}</span>
                                    </label>
                                </div>
                            </li>

                                <li>
                                <span data-toggle="modal" data-target="#myModal"><button type="button" class="btn btn-warning btn-sm navbar-btn" data-toggle="tooltip" data-placement="bottom" title="Filter" style="margin-left:5px"><span class="glyphicon glyphicon-filter" {% if orderby != 'date' or tiger_certainty != 'all' or site_certainty != 'all' or status != 'all' %}style="color:black"{% endif %}></span>
                                </button></span>
                            </li>

{% endblock %}

{% block grab_reports_button %}
{% endblock %}

{% block view_others_annotations %}
    <strong>Mean Tiger Certainty Score: {{ form.instance.report.get_mean_expert_adult_score | floatformat }}</strong><br>
    <strong>Mean Site Certainty Score: {{ form.instance.report.get_mean_expert_site_score | floatformat }}</strong><br>
        <div style="overflow: auto; height: 500px;" id='other_annotations_alert{{ form.instance.id }}'
             class='alert alert-info' role='alert'>
            {{ form.instance.get_others_annotation_html | safe }}
        </div>

{% endblock %}


{% block filter_modal %}
    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Filters</h4>
                </div>
                <div class="modal-body">
                    <form role="form" class="form-horizontal">

                        <div class="form-group">
                            <label for="orderby_select" class="col-sm-4 control-label">Order By:</label>

                            <div class="col-sm-8">
                                <select id="orderby_select" class="selectpicker show-tick form-control">
                                    <option value="date">Report Date</option>
                                    <option value="tiger_score">Tiger Certainty Score</option>
                                    <option value="site_score">Site Certainty Score</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="tiger_certainty_select" class="col-sm-4 control-label">Tiger Certainty
                                Category:</label>

                            <div class="col-sm-8">
                                <select id="tiger_certainty_select" class="selectpicker show-tick form-control">
                                    <option value="all">All</option>
                                    <option value="-2">Definitely not a tiger mosquito</option>
                                    <option value="-1">Probably not a tiger mosquito</option>
                                    <option value="0">Not sure</option>
                                    <option value="1">Probably a tiger mosquito</option>
                                    <option value="2">Definitely a tiger mosquito</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="site_certainty_select" class="col-sm-4 control-label">Site Certainty
                                Category:</label>

                            <div class="col-sm-8">
                                <select id="site_certainty_select" class="selectpicker show-tick form-control">
                                    <option value="all">All</option>
                                    <option value="-2">Definitely not a breeding site</option>
                                    <option value="-1">Probably not a breeding site</option>
                                    <option value="0">Not sure</option>
                                    <option value="1">Probably a breeding site</option>
                                    <option value="2">Definitely a breeding site</option>
                                </select>
                            </div>
                        </div>
                            <div class="form-group">
                                <label for="status_select" class="col-sm-4 control-label">Status:</label>

                                <div class="col-sm-8">
                                    <select id="status_select" class="selectpicker show-tick form-control">
                                        <option value="all">All</option>
                                        <option value="public">Public</option>
                                        <option value="flagged">Flagged</option>
                                        <option value="hidden">Hidden</option>
                                    </select>
                                </div>
                            </div>

                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="button" id="filters_submit_button" class="btn btn-warning">Apply</button>
                </div>
            </div>
        </div>
    </div>


{% endblock %}



{% block filterjs %}
    <script>

        var public_btn = $("#public_btn"), flagged_btn = $("#flagged_btn"), hidden_btn = $("#hidden_btn");

        $("#orderby_select").val("{{ orderby }}");
        $("#tiger_certainty_select").val("{{ tiger_certainty }}");
        $("#site_certainty_select").val("{{ site_certainty }}");
        $("#status_select").val("{{ status }}");

        if ("{{ final_status }}" == "public") {
            public_btn.addClass("active");
        }
        else if ("{{ final_status }}" == "flagged") {
            flagged_btn.addClass("active");
        }
        else if ("{{ final_status }}" == "hidden") {
            hidden_btn.addClass("active");
        }



                var unchecked_btn = $("#unchecked_btn"), confirmed_btn = $("#confirmed_btn"), revised_btn = $("#revised_btn");

                        activise_checked_btns = function(){
        checked == "revised" ? revised_btn.addClass("active") : (checked == "confirmed"? confirmed_btn.addClass("active") : unchecked_btn.addClass("active"));
        }

        var checked = "{{ checked }}";
        activise_checked_btns();

        function query_selectors() {
            var qp = "?orderby=" + $("#orderby_select").val();
            qp += "&tiger_certainty=" + $("#tiger_certainty_select").val();
            qp += "&site_certainty=" + $("#site_certainty_select").val();
            qp += "&status=" + $("#status_select").val();
            if(flagged_btn.hasClass("active")){
                qp += "&final_status=flagged";
            } else if(hidden_btn.hasClass("active")){
                qp += "&final_status=hidden";
            } else {
                qp += "&final_status=public";
            }
            if(revised_btn.hasClass("active")){
                qp += "&checked=revised";
            } else if(confirmed_btn.hasClass("active")){
                qp += "&checked=hidden";
            } else {
                qp += "&checked=unchecked";
            }

            return(qp);
        }



        function submit_queries() {
            gear.show();
            var qp = query_selectors();
            $('#myModal').modal('hide');
            window.location.href = qp;
        }

        function submit_queries_final_status(event) {
            gear.show();
            event.data.extr;
            var qp = query_selectors();
            window.location.href = qp;
        }

        public_btn.on('click', {extr: 'public'}, submit_queries_final_status);
        flagged_btn.on('click', { extr: 'flagged'}, submit_queries_final_status);
        hidden_btn.on('click', {extr: 'hidden'}, submit_queries_final_statu);


        unchecked_btn.on('click', {extr: 'unchecked'}, submit_queries_checked);
        confirmed_btn.on('click', { extr: 'confirmed'}, submit_queries_checked);
        revised_btn.on('click', { extr: 'revised'}, submit_queries_checked);



    </script>

{% endblock %}
