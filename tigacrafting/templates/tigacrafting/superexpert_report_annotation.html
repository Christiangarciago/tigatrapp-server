{% extends "tigacrafting/expert_report_annotation.html" %}
{% load staticfiles %}
{% load i18n %}

{% block title %}
    <h1>Superexpert Validation</h1>
    <h2>{% if checked == 'unchecked' %}Unchecked Reports{% elif checked == 'confirmed' %}Confirmed
        Reports{% elif checked == 'revised' %}Revised Reports{% endif %}</h2>
{% endblock %}

{% block instructions %}
    <p>Each of the reports displayed here has been validated by 3 experts. You may now review these reports and confirm
        them as is or mark them for revision and make changes using the same form that the experts used</p>
{% endblock %}

{% block no_records_message %}
    {% if n_unchecked == 0 %}
        There are not yet any reports that have been validated by 3 experts. Please refresh this page later, once more
        expert validations have been completed.
    {% else %}
        There are no reports that match your search criteria.
    {% endif %}
{% endblock %}

{% block navbar_left_items %}
    <li>
        <div class="btn-group" id="type_grp" data-toggle="buttons" style="margin-right:5px;">
            <label class="btn btn-info btn-sm navbar-btn" data-toggle="tooltip" data-placement="bottom" title="Public"
                   id="public_btn">
                <input type="radio" name="options" autocomplete="off"><span class="glyphicon glyphicon-eye-open"></span> <span
                    class="badge">{{ n_public }}</span></label>
            <label class="btn btn-info btn-sm navbar-btn" data-toggle="tooltip" data-placement="bottom" title="Flagged"
                   id="flagged_btn">
                <input type="radio" name="options" autocomplete="off"><span
                    class="glyphicon glyphicon-flag"></span> <span
                    class="badge">{{ n_flagged }}</span>
            </label>
            <label class="btn btn-info btn-sm navbar-btn" data-toggle="tooltip" data-placement="bottom" title="Hidden"
                   id="hidden_btn">
                <input type="radio" name="options" autocomplete="off"><span
                    class="glyphicon glyphicon-eye-close"></span> <span
                    class="badge">{{ n_hidden }}</span>
            </label>
        </div>
    </li>

    <li>

        <div class="btn-group" id="status_grp" data-toggle="buttons">
            <label class="btn btn-primary btn-sm navbar-btn" data-toggle="tooltip" data-placement="bottom"
                   title="Unchecked" id="unchecked_btn">
                <input type="radio" name="pending" autocomplete="off"><span class="glyphicon glyphicon-time"
                                                                            {% if n_unchecked > 0 %}style="color:#FF8576"{% endif %}></span>
                <span class="badge">{{ n_unchecked }}</span></label>
            <label class="btn btn-primary btn-sm navbar-btn" data-toggle="tooltip" data-placement="bottom"
                   title="Checked and confirmed" id="confirmed_btn">
                <input type="radio" name="pending" autocomplete="off"><span
                    class="glyphicon glyphicon-thumbs-up"></span> <span
                    class="badge">{{ n_confirmed }}</span>
            </label>
            <label class="btn btn-primary btn-sm navbar-btn" data-toggle="tooltip" data-placement="bottom"
                   title="Checked and revised" id="revised_btn">
                <input type="radio" name="pending" autocomplete="off"><span
                    class="glyphicon glyphicon-thumbs-down"></span> <span
                    class="badge">{{ n_revised }}</span>
            </label>
        </div>
    </li>

{% endblock %}

{% block grab_reports_button %}
{% endblock %}

{% block report_title_status_row %}
    <div class="row">
        <div class="col-md-12">
            <strong>Current Status:</strong> {{ form.instance.report.get_final_expert_status_bootstrap | safe }} {{ form.instance.report.get_final_expert_score_bootstrap | safe }}<br>
            <strong>Individual Expert Responses:</strong><br>
            {{ form.instance.report.get_expert_score_reports_bootstrap | safe }}
        </div>
    </div>
{% endblock %}


{% block view_others_annotations %}

{% endblock %}


{% block filterjs %}
    <script>


        $("#orderby_select").val("{{ orderby }}");
        $("#tiger_certainty_select").val("{{ tiger_certainty }}");
        $("#site_certainty_select").val("{{ site_certainty }}");
        $("#status_select").val("{{ status }}");

        var public_btn = $("#public_btn"), flagged_btn = $("#flagged_btn"), hidden_btn = $("#hidden_btn");


        var final_status = "{{ final_status }}";


        var unchecked_btn = $("#unchecked_btn"), confirmed_btn = $("#confirmed_btn"), revised_btn = $("#revised_btn");


        var checked = "{{ checked }}";

        function clear_btns() {
            public_btn.removeClass("active");
            flagged_btn.removeClass("active");
            hidden_btn.removeClass("active");
            unchecked_btn.removeClass("active");
            revised_btn.removeClass("active");
            confirmed_btn.removeClass("active");
        }

        function activate_btns() {
            clear_btns();
            final_status == "public" ? public_btn.addClass("active") : (final_status == "flagged" ? flagged_btn.addClass("active") : (final_status == "hidden" ? hidden_btn.addClass("active") : {}) );
            checked == "revised" ? revised_btn.addClass("active") : (checked == "confirmed" ? confirmed_btn.addClass("active") : (checked == "unchecked" ? unchecked_btn.addClass("active") : {} ));

        }

        activate_btns();


        function query_selectors() {
            var qp = "?orderby=" + $("#orderby_select").val();
            qp += "&tiger_certainty=" + $("#tiger_certainty_select").val();
            qp += "&site_certainty=" + $("#site_certainty_select").val();
            qp += "&status=" + $("#status_select").val();
            if (flagged_btn.hasClass("active")) {
                qp += "&final_status=flagged";
            } else if (hidden_btn.hasClass("active")) {
                qp += "&final_status=hidden";
            } else {
                qp += "&final_status=public";
            }
            if (revised_btn.hasClass("active")) {
                qp += "&checked=revised";
            } else if (confirmed_btn.hasClass("active")) {
                qp += "&checked=confirmed";
            } else {
                qp += "&checked=unchecked";
            }

            return(qp);
        }


        function submit_queries() {
            gear.show();
            var qp = query_selectors();
            $('#myModal').modal('hide');
            window.location.href = qp;
        }

        function submit_queries_final_status(event) {
            gear.show();
            final_status = event.data.extr;
            activate_btns();
            window.location.href = query_selectors();
        }

        function submit_queries_checked(event) {
            gear.show();
            checked = event.data.extr;
            activate_btns();
            window.location.href = query_selectors();
        }

        public_btn.on('click', {extr: 'public'}, submit_queries_final_status);
        flagged_btn.on('click', { extr: 'flagged'}, submit_queries_final_status);
        hidden_btn.on('click', {extr: 'hidden'}, submit_queries_final_status);


        unchecked_btn.on('click', {extr: 'unchecked'}, submit_queries_checked);
        confirmed_btn.on('click', { extr: 'confirmed'}, submit_queries_checked);
        revised_btn.on('click', { extr: 'revised'}, submit_queries_checked);


    </script>

{% endblock %}
