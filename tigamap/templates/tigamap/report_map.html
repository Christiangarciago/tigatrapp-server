{% extends "tigamap/app.html" %}

{% load staticfiles %}
{% load i18n %}

{% load leaflet_tags %}

{% block leaflet_code %}


    {% if report_type == 'adults' %}
        {% leaflet_js plugins="marker_cluster_yellow" %}
        {% leaflet_css plugins="marker_cluster_yellow" %}
   {% else %}
        {% leaflet_js plugins="marker_cluster_blue" %}
        {% leaflet_css plugins="marker_cluster_blue" %}
    {% endif %}


    <script type="text/javascript">

        function map_init_basic(map, options) {


            var markers_clustered = new L.MarkerClusterGroup();

            var markers_basic = new L.LayerGroup();

            var YellowIcon = L.Icon.Default.extend({
                options: {
                    iconUrl: '{% static "tigamap/yellow_icon.png" %}'
                }
            });

            var thisIcon = new L.Icon.Default;
            {% if report_type == 'adults' %}
                thisIcon = new YellowIcon();
            {% endif %}

            var show_popups = true;

            var marker;

            {% for report in report_list %}
                {% if report.lat != None and report.lon != None %}
                    marker = L.marker([{{ report.lat }}, {{ report.lon }}], {icon: thisIcon});
                    if(show_popups){
                    {% if report_type == 'adults' %}
                        marker.bindPopup('<table style="font-size:small;"><tr><td>id:</td><td>' +
                                '{{ report.report_id }}</td></tr><tr><td>lat:</td>'+
                                '<td>{{ report.lat }}</td></tr><tr><td>lon:</td><td>'+
                                '{{ report.lon }}</td></tr><tr><td>prob:</td><td>'+
                                '{{ report.tigaprob }}</td></tr></table>');
                   {%  else %}
                        marker.bindPopup('<table style="font-size:small;"><tr><td>id:</td><td>' +
                                '{{ report.report_id }}</td></tr><tr><td>lat:</td>'+
                                '<td>{{ report.lat }}</td></tr><tr><td>lon:</td><td>'+
                                '{{ report.lon }}</td></tr><tr><td>type:</td><td>'+
                                '{{ report.site_type }}</td></tr></table>');
                   {%  endif %}
                   }
                    markers_clustered.addLayer(marker);
                    markers_basic.addLayer(marker);
                {% endif %}
            {% endfor %}

            var baseMaps = {
                "clusters": markers_clustered,
                "points": markers_basic
            };

            markers_clustered.addTo(map);

            L.control.layers(baseMaps, null).addTo(map);
        }
    </script>

{% endblock %}


