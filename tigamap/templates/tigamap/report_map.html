{% extends "tigamap/base.html" %}

{% load staticfiles %}

{% block leaflet_code %}

    <script type="text/javascript">
        function map_init_basic(map, options) {

            var oms = new OverlappingMarkerSpiderfier(map);

            var markers_all = new L.MarkerClusterGroup();
            var markers_medium = new L.MarkerClusterGroup();
            var markers_high = new L.MarkerClusterGroup();

            var low = new L.LayerGroup();
            var high = new L.LayerGroup();

            var YellowIcon = L.Icon.Default.extend({
                options: {
                    iconUrl: '{% static "tigamap/yellow_icon.png" %}'
                }
            });
            var yellowIcon = new YellowIcon();

            var marker;

            {% for report in report_list %}
                {% if report.lat != None and report.lon != None %}
                    {% if report.type == "adult" %}
                        marker = L.marker([{{ report.lat }}, {{ report.lon }}], {icon: yellowIcon});
                        markers_all.addLayer(marker)
                        oms.addMarker(marker);
                       {% if report.tigaprob >= 1 and report.tigaprob < 3 %}
                            marker = L.marker([{{ report.lat }}, {{ report.lon }}], {icon: yellowIcon});
                            markers_medium.addLayer(marker)
                            oms.addMarker(marker);
                        {% endif %}
                        {% if report.tigaprob == 3 %}
                            marker = L.marker([{{ report.lat }}, {{ report.lon }}], {icon: yellowIcon});
                            markers_high.addLayer(marker)
                            oms.addMarker(marker);

                        {% endif %}
                    {% endif %}
                {% endif %}
            {% endfor %}

            var baseMaps = {
                "All reports": markers_all,
                "High-probability reports only": markers_medium,
                "High-probability reports only": markers_high
            };

            markers_all.addTo(map);

            L.control.layers(baseMaps, null).addTo(map);
        }
    </script>

{% endblock %}


{% block logo %}
    <img src={% static "tigamap/tigatrapp_logo.png" %} style="position:absolute;width:30%;bottom:20px; right:10px">
{% endblock %}
